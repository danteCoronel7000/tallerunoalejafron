<div class="h-screen flex flex-col bg-gradient-to-br from-gray-50 to-gray-100 overflow-hidden">
    <div class="flex-1 flex flex-col max-w-7xl mx-auto w-full overflow-y-hidden">
        <!-- Header - Fijo arriba -->
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-4 border border-gray-100 flex-shrink-0">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-2">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900 mb-1">Gestión de Menus</h1>
                    <p class="text-gray-500 text-sm">Administra los Menus y permisos del sistema</p>
                </div>
                <button (click)="openMenuModal()"
                    class="bg-gradient-to-r from-[#2d14ee] to-[#6146f2] hover:from-[#6146f2] hover:to-[#2d14ee] text-white px-6 py-3 rounded-xl flex items-center gap-2 transition-all duration-300 shadow-lg shadow-[#2d14ee]/30 hover:shadow-xl hover:shadow-[#2d14ee]/40 hover:-translate-y-0.5">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M5 12h14" />
                        <path d="M12 5v14" />
                    </svg>
                    <span class="font-semibold">Nuevo Menu</span>
                </button>
            </div>

            <!-- Filtros -->
            <div
                class="flex flex-col lg:flex-row lg:items-center gap-6 bg-gray-50 rounded-xl p-4 border border-gray-200">
                <!-- Campo Filtro -->
                <div class="flex-1">
                    <label class="text-gray-700 font-semibold mb-2 block text-sm">Buscar menu</label>
                    <div class="relative">
                        <div class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <circle cx="11" cy="11" r="8" />
                                <path d="m21 21-4.35-4.35" />
                            </svg>
                        </div>
                        <input type="text" #filtroInput
                            (keyup.enter)="onEnterFiltro(filtroInput.value)"
                            class="border border-gray-300 rounded-xl pl-10 pr-10 py-3 w-full focus:outline-none focus:ring-2 focus:ring-[#6146f2] focus:border-transparent transition-all duration-200 bg-white"
                            placeholder="Buscar por nombre de menu..." />

                        <!-- Botón limpiar -->
                        @if (filtroValue) {
                        <button (click)="limpiarFiltro(filtroInput)"
                            class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full p-1 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <line x1="18" y1="6" x2="6" y2="18" />
                                <line x1="6" y1="6" x2="18" y2="18" />
                            </svg>
                        </button>
                        }
                    </div>
                </div>

                <!-- Radio Buttons -->
                <div class="lg:border-l lg:border-gray-300 lg:pl-6">
                    <label class="text-gray-700 font-semibold mb-2 block text-sm">Estado del menu</label>
                    <div class="flex flex-wrap items-center gap-3">
                        <label class="flex items-center gap-2 cursor-pointer group">
                            <input type="radio" name="estado" value="activos"
                                [checked]="estadoSeleccionado === '1'" (click)="seleccionarEstado('1')"
                                class="w-4 h-4 text-[#2d14ee] cursor-pointer focus:ring-2 focus:ring-[#6146f2] focus:ring-offset-2" />
                            <span
                                class="text-gray-700 font-medium group-hover:text-[#2d14ee] transition-colors">Activos</span>
                        </label>

                        <label class="flex items-center gap-2 cursor-pointer group">
                            <input type="radio" name="estado" value="bajas" [checked]="estadoSeleccionado === '0'"
                                (click)="seleccionarEstado('0')"
                                class="w-4 h-4 text-[#2d14ee] cursor-pointer focus:ring-2 focus:ring-[#6146f2] focus:ring-offset-2" />
                            <span
                                class="text-gray-700 font-medium group-hover:text-[#2d14ee] transition-colors">Bajas</span>
                        </label>

                        <label class="flex items-center gap-2 cursor-pointer group">
                            <input type="radio" name="estado" value="todos" [checked]="estadoSeleccionado === 'todos'"
                                (click)="seleccionarEstado('todos')"
                                class="w-4 h-4 text-[#2d14ee] cursor-pointer focus:ring-2 focus:ring-[#6146f2] focus:ring-offset-2" />
                            <span
                                class="text-gray-700 font-medium group-hover:text-[#2d14ee] transition-colors">Todos</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabla de Roles con Scroll limitado a 4 filas -->
        <div class="bg-white rounded-2xl shadow-lg border border-gray-100 flex flex-col overflow-hidden">
            <!-- Contenedor con altura fija para 4 filas + scroll interno -->
            <div class="h-[38vh] overflow-y-auto">
                <table class="w-full">
                    <thead class="bg-gradient-to-r from-[#2d14ee] to-[#6146f2] sticky top-0 z-10">
                        <tr>
                            <th class="px-6 py-4 text-left text-sm font-semibold text-white">
                                Nombre del Menu
                            </th>
                            <th class="px-6 py-4 text-center text-sm font-semibold text-white">
                                Estado
                            </th>
                            <th class="px-6 py-4 text-center text-sm font-semibold text-white">
                                Modificar
                            </th>
                            <th class="px-6 py-4 text-center text-sm font-semibold text-white">
                                Eliminar
                            </th>
                            <th class="px-6 py-4 text-center text-sm font-semibold text-white">
                                Historial
                            </th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100">
                        @for (rol of listMenus(); track rol.codm) {
                        <tr
                            class="hover:bg-gradient-to-r hover:from-[#ffdeff]/20 hover:to-[#caabfb]/20 transition-all duration-200">
                            <td class="px-6 py-4 text-sm font-medium text-gray-800">
                                {{ rol.nombre }}
                            </td>
                            <td class="px-6 py-4 text-center">
                                <span
                                    [class]="rol.estado === 1 
                                        ? 'inline-flex px-4 py-1.5 rounded-full text-xs font-semibold bg-gradient-to-r from-green-100 to-green-50 text-green-700 border border-green-200'
                                        : 'inline-flex px-4 py-1.5 rounded-full text-xs font-semibold bg-gradient-to-r from-red-100 to-red-50 text-red-700 border border-red-200'">
                                    {{ rol.estado }}
                                </span>
                            </td>
                            <td class="px-6 py-4 text-center">
                                <button (click)="menuState.openEditModal(rol)"
                                    class="p-2.5 hover:bg-[#caabfb]/30 rounded-lg transition-all duration-200 hover:shadow-md group"
                                    title="Modificar">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round"
                                        class="text-[#6146f2] group-hover:text-[#2d14ee] transition-colors">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
                                    </svg>
                                </button>
                            </td>
                           <td class="px-6 py-4 text-center">
                                    <button
                                    (click)="abrirModalDeshabilitar(rol)"
                                        class="p-2.5 hover:bg-red-50 rounded-lg transition-all duration-200 hover:shadow-md group" 
                                        title="Eliminar">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                            stroke-linejoin="round" class="text-red-500 group-hover:text-red-700 transition-colors">
                                            <polyline points="3 6 5 6 21 6" />
                                            <path
                                                d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                                        </svg>
                                    </button>
                                </td>
                                <td class="px-6 py-4 text-center">
                                    <button
                                    (click)="abrirModalHabilitar(rol)"
                                        class="p-2.5 hover:bg-[#caabfb]/30 rounded-lg transition-all duration-200 hover:shadow-md group" 
                                        title="Historial">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                            stroke-linejoin="round" class="text-[#6146f2] group-hover:text-[#2d14ee] transition-colors">
                                            <path
                                                d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2" />
                                        </svg>
                                    </button>
                                </td>
                        </tr>
                        }
                    </tbody>
                </table>
            </div>

            <!-- NAV FIJO AL FONDO -->
            <nav class="flex-shrink-0 flex flex-col sm:flex-row items-center bg-gradient-to-r from-gray-50 to-gray-100 px-6 py-4 gap-4 justify-between border-t border-gray-200"
                aria-label="Table navigation">
                <!-- Información de paginación -->
                <span class="text-sm font-medium text-gray-600 whitespace-nowrap">
                    Mostrando
                    <span class="font-bold text-[#2d14ee]">
                        {{ currentPage * pageSize + 1 }} -
                        {{ (currentPage * pageSize + listMenus.length) }}
                    </span>
                    de
                    <span class="font-bold text-[#2d14ee]">{{ totalElements }}</span>
                </span>

                <!-- Select -->
                <div class="relative">
                    <select (change)="cambiarPageSize($event)"
                        class="rounded-xl border-gray-300 shadow-sm text-sm font-medium px-4 py-2.5 pr-10 min-w-[160px] bg-white focus:border-[#6146f2] focus:ring-2 focus:ring-[#6146f2]/20 transition-all duration-200 cursor-pointer hover:border-[#9679f7]">
                        <option [value]="3">3 por pagina</option>
                        <option [value]="24">24 por pagina</option>
                        <option [value]="32">32 por pagina</option>
                        <option [value]="50">50 por pagina</option>
                        <option [value]="100">100 por pagina</option>
                    </select>
                    <div class="absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-gray-500">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        </svg>
                    </div>
                </div>

                <!-- Botones -->
                <div class="flex gap-2">
                    <button (click)="cambiarPagina(currentPage - 1)" [disabled]="isFirst"
                        class="flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-semibold text-gray-700 bg-white border border-gray-300 rounded-xl hover:bg-gray-50 hover:border-[#9679f7] hover:text-[#2d14ee] disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-white disabled:hover:border-gray-300 disabled:hover:text-gray-700 transition-all duration-200 shadow-sm hover:shadow-md">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="15 18 9 12 15 6" />
                        </svg>
                        Anterior
                    </button>
                    <button (click)="cambiarPagina(currentPage + 1)" [disabled]="isLast"
                        class="flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-semibold text-white bg-gradient-to-r from-[#2d14ee] to-[#6146f2] hover:from-[#6146f2] hover:to-[#2d14ee] border border-transparent rounded-xl disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-lg shadow-[#2d14ee]/30 hover:shadow-xl hover:shadow-[#2d14ee]/40 hover:-translate-y-0.5">
                        Siguiente
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="9 18 15 12 9 6" />
                        </svg>
                    </button>
                </div>
            </nav>
        </div>
    </div>
</div>

@if(showMenuModal){
<app-new-menu (menuCreated)="onMenuCreated()" (cancel)="onMenuCancel()">
</app-new-menu>
}


<!-- Modal -->
@if (menuState.isOpen()) {
<app-edit-menu></app-edit-menu>
}

<!-- Modal Deshabilitar Rol (Estado 0) -->
@if (isModalDeshabilitarVisible) {
<div
    class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm transition-all duration-300 animate-in fade-in">
    <div
        class="bg-white rounded-2xl shadow-2xl w-full max-w-md mx-4 transform transition-all duration-300 scale-100 animate-in zoom-in-95">
        <!-- Header -->
        <div class="px-8 py-6 border-b border-gray-100 bg-gradient-to-r from-red-500 to-red-600 rounded-t-2xl">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="text-white">
                            <circle cx="12" cy="12" r="10" />
                            <line x1="15" y1="9" x2="9" y2="15" />
                            <line x1="9" y1="9" x2="15" y2="15" />
                        </svg>
                    </div>
                    <h2 class="text-xl font-bold text-white">Deshabilitar Menu</h2>
                </div>
                <button type="button" (click)="cerrarModalDeshabilitar()"
                    class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-white/20 transition-colors text-white/80 hover:text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
        </div>

        <!-- Body -->
        <div class="px-8 py-6">
            <div class="flex flex-col items-center text-center">
                <!-- Icono de advertencia -->
                <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="text-red-600">
                        <path
                            d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" />
                        <line x1="12" y1="9" x2="12" y2="13" />
                        <line x1="12" y1="17" x2="12.01" y2="17" />
                    </svg>
                </div>

                <!-- Mensaje -->
                <h3 class="text-lg font-bold text-gray-900 mb-2">¿Está seguro de deshabilitar este menu?</h3>
                <p class="text-gray-600 mb-1">
                    El menu <span class="font-semibold text-gray-900">"{{ menuSeleccionado?.nombre }}"</span> será
                    deshabilitado.
                </p>
                <p class="text-sm text-gray-500">
                    Los usuarios con este menu perderán sus permisos asociados temporalmente.
                </p>
            </div>
        </div>

        <!-- Footer -->
        <div class="px-8 py-6 bg-gray-50 rounded-b-2xl border-t border-gray-100">
            <div class="flex justify-end gap-3">
                <button type="button" (click)="cerrarModalDeshabilitar()"
                    class="px-6 py-2.5 text-sm font-semibold text-gray-700 bg-white border border-gray-300 rounded-xl hover:bg-gray-50 hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-all duration-200 hover:shadow-md">
                    Cancelar
                </button>
                <button type="button" (click)="confirmarDeshabilitar()"
                    class="px-6 py-2.5 text-sm font-semibold text-white bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 border border-transparent rounded-xl focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-all duration-200 shadow-lg shadow-red-500/30 hover:shadow-xl hover:shadow-red-500/40 hover:-translate-y-0.5">
                    <span class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="3 6 5 6 21 6" />
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                        </svg>
                        Sí, deshabilitar
                    </span>
                </button>
            </div>
        </div>
    </div>
</div>
}

<!-- Modal Habilitar Rol (Estado 1) -->
@if (isModalHabilitarVisible) {
<div
    class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm transition-all duration-300 animate-in fade-in">
    <div
        class="bg-white rounded-2xl shadow-2xl w-full max-w-md mx-4 transform transition-all duration-300 scale-100 animate-in zoom-in-95">
        <!-- Header -->
        <div class="px-8 py-6 border-b border-gray-100 bg-gradient-to-r from-green-500 to-green-600 rounded-t-2xl">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="text-white">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                            <polyline points="22 4 12 14.01 9 11.01" />
                        </svg>
                    </div>
                    <h2 class="text-xl font-bold text-white">Habilitar Menu</h2>
                </div>
                <button type="button" (click)="cerrarModalHabilitar()"
                    class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-white/20 transition-colors text-white/80 hover:text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
        </div>

        <!-- Body -->
        <div class="px-8 py-6">
            <div class="flex flex-col items-center text-center">
                <!-- Icono de éxito -->
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="text-green-600">
                        <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z" />
                        <path d="m9 12 2 2 4-4" />
                    </svg>
                </div>

                <!-- Mensaje -->
                <h3 class="text-lg font-bold text-gray-900 mb-2">¿Está seguro de habilitar este Menu?</h3>
                <p class="text-gray-600 mb-1">
                    El menu <span class="font-semibold text-gray-900">"{{ menuSeleccionado?.nombre }}"</span> será
                    habilitado.
                </p>
                <p class="text-sm text-gray-500">
                    Los usuarios con este menu recuperarán sus permisos asociados.
                </p>
            </div>
        </div>

        <!-- Footer -->
        <div class="px-8 py-6 bg-gray-50 rounded-b-2xl border-t border-gray-100">
            <div class="flex justify-end gap-3">
                <button type="button" (click)="cerrarModalHabilitar()"
                    class="px-6 py-2.5 text-sm font-semibold text-gray-700 bg-white border border-gray-300 rounded-xl hover:bg-gray-50 hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-all duration-200 hover:shadow-md">
                    Cancelar
                </button>
                <button type="button" (click)="confirmarHabilitar()"
                    class="px-6 py-2.5 text-sm font-semibold text-white bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 border border-transparent rounded-xl focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-all duration-200 shadow-lg shadow-green-500/30 hover:shadow-xl hover:shadow-green-500/40 hover:-translate-y-0.5">
                    <span class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="20 6 9 17 4 12" />
                        </svg>
                        Sí, habilitar
                    </span>
                </button>
            </div>
        </div>
    </div>
</div>
}